<?xml version="1.0" encoding="iso-8859-1"?>
<document xmlns="http://maven.apache.org/XDOC/2.0"
  xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
  xsi:schemaLocation="http://maven.apache.org/XDOC/2.0 http://maven.apache.org/xsd/xdoc-2.0.xsd">
    <properties>
        <title>PluginPoints : JTA Locator</title>
    </properties>

    <body>
        <section name="PluginPoints : JTA Locator">
            <img src="../images/nucleus_plugin.gif" border="0" alt=""/>
            <p>
                DataNucleus is developed as a plugin-driven framework and one of the components that is pluggable is 
                the locator for JTA TransactionManagers (since J2EE doesnt define a standard mechanism for location). 
                DataNucleus provides several plugins for the principal application servers available but is structured 
                so that you can easily add your own variant and have it usable within your DataNucleus usage.
            </p>
            <p>
                Locators for JTA TransactionManagers can be plugged using the plugin extension 
                <i>org.datanucleus.jta_locator</i>. These are of relevance when running with JTA transaction and linking 
                in to the JTA transaction of some controlling application server
            </p>
            <table>
                <tr>
                    <th>Plugin extension-point</th>
                    <th>Key</th>
                    <th>Description</th>
                    <th width="80">Location</th>
                </tr>
                <tr>
                    <td>org.datanucleus.jta_locator</td>
                    <td>jboss</td>
                    <td>JBoss</td>
                    <td>datanucleus-core</td>
                </tr>
                <tr>
                    <td>org.datanucleus.jta_locator</td>
                    <td>jonas</td>
                    <td>JOnAS</td>
                    <td>datanucleus-core</td>
                </tr>
                <tr>
                    <td>org.datanucleus.jta_locator</td>
                    <td>jotm</td>
                    <td>JOTM</td>
                    <td>datanucleus-core</td>
                </tr>
                <tr>
                    <td>org.datanucleus.jta_locator</td>
                    <td>oc4j</td>
                    <td>OC4J</td>
                    <td>datanucleus-core</td>
                </tr>
                <tr>
                    <td>org.datanucleus.jta_locator</td>
                    <td>orion</td>
                    <td>Orion</td>
                    <td>datanucleus-core</td>
                </tr>
                <tr>
                    <td>org.datanucleus.jta_locator</td>
                    <td>resin</td>
                    <td>Resin</td>
                    <td>datanucleus-core</td>
                </tr>
                <tr>
                    <td>org.datanucleus.jta_locator</td>
                    <td>sap</td>
                    <td>SAP app server</td>
                    <td>datanucleus-core</td>
                </tr>
                <tr>
                    <td>org.datanucleus.jta_locator</td>
                    <td>sun</td>
                    <td>Sun ONE app server</td>
                    <td>datanucleus-core</td>
                </tr>
                <tr>
                    <td>org.datanucleus.jta_locator</td>
                    <td>weblogic</td>
                    <td>WebLogic app server</td>
                    <td>datanucleus-core</td>
                </tr>
                <tr>
                    <td>org.datanucleus.jta_locator</td>
                    <td>websphere</td>
                    <td>WebSphere 4/5</td>
                    <td>datanucleus-core</td>
                </tr>
                <tr>
                    <td>org.datanucleus.jta_locator</td>
                    <td>custom_jndi</td>
                    <td>Custom JNDI</td>
                    <td>datanucleus-core</td>
                </tr>
                <tr>
                    <td>org.datanucleus.jta_locator</td>
                    <td>atomikos</td>
                    <td>Atomikos</td>
                    <td>datanucleus-core</td>
                </tr>
            </table>
            <p>
                The following sections describe how to create your own JTA Locator plugin for DataNucleus.
            </p>
            <subsection name="Interface">
                <p>
                    If you have your own JTA Locator you can easily use it with DataNucleus.
                    DataNucleus defines a TransactionManagerLocator interface and you need to implement this.
                    <a href="http://www.datanucleus.org/javadocs/core/latest/org/datanucleus/jta/TransactionManagerLocator.html" target="_blank"><img src="../images/javadoc.gif" alt=""/></a>
                </p>
                <source>
package org.datanucleus.jta;

import javax.transaction.TransactionManager;
import org.datanucleus.ClassLoaderResolver;

public interface TransactionManagerLocator
{
    /**
     * Method to return the TransactionManager.
     * @param clr ClassLoader resolver
     * @return The TransactionManager
     */
    TransactionManager getTransactionManager(ClassLoaderResolver clr);
}</source>
                <p>
                    So you need to create a class, <b>MyTransactionManagerLocator</b> for example, that implements this interface.
                </p>
                <br/>
            </subsection>

            <subsection name="Plugin Specification">
                <p>
                    Once you have this implementation you then need to make the class available as a DataNucleus plugin.
                    You do this by putting a file <i>plugin.xml</i> in your JAR at the root of the CLASSPATH.
                    The file <i>plugin.xml</i> will look like this
                </p>
                <source><![CDATA[
<?xml version="1.0"?>
<plugin id="mydomain.mylocator" name="DataNucleus plug-ins" provider-name="My Company">
    <extension point="org.datanucleus.jta_locator">
        <jta_locator name="MyLocator" class-name="mydomain.MyTransactionManagerLocator"/>
    </extension>
</plugin>]]></source>
                <p>
                    Note that you also require a MANIFEST.MF file as per the 
                    <a href="index.html">PluginPoints Guide</a>.
                </p>
            </subsection>

            <subsection name="Plugin Usage">
                <p>
                    The only thing remaining is to use your JTA Locator plugin. To do this you specify the 
                    <a href="../jdo/pmf.html">PersistenceManagerFactory</a> property <i>datanucleus.jtaLocator</i> 
                    as <b>MyLocator</b> (the "name" in <i>plugin.xml</i>).
                </p>
            </subsection>
        </section>
    </body>
</document>