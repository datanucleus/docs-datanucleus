<?xml version="1.0" encoding="iso-8859-1"?>
<document xmlns="http://maven.apache.org/XDOC/2.0"
  xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
  xsi:schemaLocation="http://maven.apache.org/XDOC/2.0 http://maven.apache.org/xsd/xdoc-2.0.xsd">
    <properties>
        <title>PluginPoints : Connection Pooling</title>
    </properties>

    <body>
        <section name="PluginPoints : Connection Pooling">
            <img src="../images/nucleus_plugin.gif" border="0" alt=""/>
            <p>
                DataNucleus is developed as a plugin-driven framework and one of the components that is 
                pluggable is  the pooling of connections to RDBMS datastores. DataNucleus provides a large selection
                of connection pools (DBCP, C3P0, Proxool, BoneCP) but is structured so that you can easily add your 
                own variant and have it usable within your DataNucleus usage.
            </p>
            <p><b>Note that this plugin point replaces the earlier
                <a href="rdbms_datasource.html">RDBMS DataSource ConnectionPool</a></b> (used up to and including 3.2.7 of datanucleus-rdbms).</p>
            <p>
                DataNucleus requires a DataSource to define the datastore in use and consequently allows use of 
                connection pooling. DataNucleus provides plugins for various different pooling products, shown below. 
                You can easily define your own plugin for pooling. You can extend DataNucleus's capabilities 
                using the plugin extension <i>org.datanucleus.store.rdbms.connectionpool</i>.
            </p>
            <table>
                <tr>
                    <th>Plugin extension-point</th>
                    <th>Key</th>
                    <th>Description</th>
                    <th width="80">Location</th>
                </tr>
                <tr>
                    <td>org.datanucleus.store.rdbms.connectionpool</td>
                    <td>dbcp-builtin</td>
                    <td>RDBMS connection pool, using Apache DBCP builtin</td>
                    <td>datanucleus-rdbms</td>
                </tr>
                <tr>
                    <td>org.datanucleus.store.rdbms.connectionpool</td>
                    <td>bonecp</td>
                    <td>RDBMS connection pool, using BoneCP</td>
                    <td>datanucleus-rdbms</td>
                </tr>
                <tr>
                    <td>org.datanucleus.store.rdbms.connectionpool</td>
                    <td>c3p0</td>
                    <td>RDBMS connection pool, using C3P0</td>
                    <td>datanucleus-rdbms</td>
                </tr>
                <tr>
                    <td>org.datanucleus.store.rdbms.connectionpool</td>
                    <td>dbcp</td>
                    <td>RDBMS connection pool, using Apache DBCP</td>
                    <td>datanucleus-rdbms</td>
                </tr>
                <tr>
                    <td>org.datanucleus.store.rdbms.connectionpool</td>
                    <td>proxool</td>
                    <td>RDBMS connection pool, using Proxool</td>
                    <td>datanucleus-rdbms</td>
                </tr>
                <tr>
                    <td>org.datanucleus.store.rdbms.connectionpool</td>
                    <td>tomcat</td>
                    <td>RDBMS connection pool, using Tomcat pool</td>
                    <td>datanucleus-rdbms</td>
                </tr>
            </table>
            <p>
                The following sections describe how to create your own connection pooling plugin for DataNucleus.
            </p>

            <subsection name="Interface">
                <p>
                    If you have your own DataSource connection pooling implementation you can easily use it with 
                    DataNucleus.
                    <a href="http://www.datanucleus.org/javadocs/store.rdbms/latest/org/datanucleus/store/rdbms/connectionpool/ConnectionPoolFactory.html" target="_blank"><img src="../images/javadoc.gif" alt=""/></a>
                    DataNucleus defines a ConnectionPoolFactory interface and you need to implement this.
                </p>
                <source>
package org.datanucleus.store.rdbms.connectionpool;

public interface ConnectionPoolFactory
{
    /**
     * Method to make a ConnectionPool for use within DataNucleus.
     * @param storeMgr StoreManager
     * @return The ConnectionPool
     * @throws Exception Thrown if an error occurs during creation
     */
    public ConnectionPool createConnectionPool(StoreManager storeMgr);
}</source>
                <p>
                    where you also define a ConnectionPool
                    <a href="http://www.datanucleus.org/javadocs/store.rdbms/latest/org/datanucleus/store/rdbms/connectionpool/ConnectionPool.html" target="_blank"><img src="../images/javadoc.gif" alt=""/></a>
                </p>
                <source>
package org.datanucleus.store.rdbms.connectionpool;

public interface ConnectionPool
{
    /**
     * Method to call when closing the StoreManager down, and consequently to close the pool.
     */
    void close();

    /**
     * Accessor for the pooled DataSource.
     * @return The DataSource
     */
    DataSource getDataSource();
}</source>
                <br/>
            </subsection>

            <subsection name="Plugin Specification">
                <p>
                    The only thing required now is to register this plugin with DataNucleus when you start up your application.
                    To do this create a file <i>plugin.xml</i> and put it in your JAR at the root of the CLASSPATH. 
                    It should look like this
                </p>
                <source><![CDATA[
<?xml version="1.0"?>
<plugin id="mydomain" name="DataNucleus plug-ins" provider-name="My Company">
    <extension point="org.datanucleus.store.rdbms.connectionpool">
        <connectionpool-factory name="mypool" class-name="mydomain.MyConnectionPoolFactory"/>
    </extension>
</plugin>]]></source>
                <p>
                    Note that you also require a MANIFEST.MF file as per the
                    <a href="index.html">PluginPoints Guide</a>.
                </p>
            </subsection>

            <subsection name="Plugin Usage">
                <p>
                    The only thing remaining is to use your new <i>ConnectionPoolFactory</i> plugin. You do 
                    this by having your plugin in the CLASSPATH at runtime, and setting the persistence property 
                    <b>datanucleus.connectionPoolingType</b> to <i>mypool</i> (the name you specified in the plugin.xml file).
                </p>
            </subsection>
        </section>

    </body>
</document>