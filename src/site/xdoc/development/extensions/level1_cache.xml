<?xml version="1.0" encoding="iso-8859-1"?>
<document xmlns="http://maven.apache.org/XDOC/2.0"
  xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
  xsi:schemaLocation="http://maven.apache.org/XDOC/2.0 http://maven.apache.org/xsd/xdoc-2.0.xsd">
    <properties>
        <title>PluginPoints : Level 1 Cache</title>
    </properties>

    <body>
        <section name="PluginPoints : Level 1 Cache">
            <img src="../../images/nucleus_plugin.gif" border="0" alt=""/>
            <p>
                DataNucleus is developed as a plugin-driven framework and one of the components that is pluggable is 
                the Level 1 caching of objects (between PersistenceManagers for the same PersistenceManagerFactory). 
                The Cache guide (<a href="../jdo/cache.html">JDO</a> or <a href="../jpa/cache.html">JPA</a>) defines 
                three Level 1 caches but is a plugin point so that you can easily add your own variant and have
                it usable within your DataNucleus usage.
            </p>
            <p>
                DataNucleus is able to support third party Level 1 Cache products. There are DataNucleus-provided plugins for
                weak and soft referenced caches. You can extend DataNucleus's capabilities using the
                plugin extension <i>org.datanucleus.cache_level1</i>. 
            </p>
            <table>
                <tr>
                    <th>Plugin extension-point</th>
                    <th>Key</th>
                    <th>Description</th>
                    <th width="80">Location</th>
                </tr>
                <tr>
                    <td>org.datanucleus.cache_level1</td>
                    <td>weak</td>
                    <td>Weak referenced cache (default)</td>
                    <td>datanucleus-core</td>
                </tr>
                <tr>
                    <td>org.datanucleus.cache_level1</td>
                    <td>soft</td>
                    <td>Soft referenced cache</td>
                    <td>datanucleus-core</td>
                </tr>
                <tr>
                    <td>org.datanucleus.cache_level1</td>
                    <td>hard</td>
                    <td>Hard-referenced cache (HashMap)</td>
                    <td>datanucleus-core</td>
                </tr>
            </table>
            <p>
                The following sections describe how to create your own Level 1 cache plugin for DataNucleus.
            </p>
            <subsection name="Interface">
                <p>
                    If you have your own Level1 cache you can easily use it with DataNucleus.
                    DataNucleus defines a Level1Cache interface and you need to implement this.
                    <a href="http://www.datanucleus.org/javadocs/core/latest/org/datanucleus/cache/Level1Cache.html" target="_blank"><img src="../images/javadoc.gif" alt=""/></a>
                </p>
                <source>
package org.datanucleus.cache;

public interface Level1Cache extends Map
{
}</source>
                <p>
                    So you need to create a class, <b>MyLevel1Cache</b> for example, that implements this 
                    interface (i.e that implements <i>java.util.Map</i>).
                </p>
                <br/>
            </subsection>

            <subsection name="Plugin Specification">
                <p>
                    Once you have this implementation you then need to make the class available as a 
                    DataNucleus plugin. You do this by putting a file <i>plugin.xml</i> in your JAR at the 
                    root of the CLASSPATH. The file <i>plugin.xml</i> will look like this
                </p>
                <source><![CDATA[
<?xml version="1.0"?>
<plugin id="mydomain.mycache" name="DataNucleus plug-ins" provider-name="My Company">
    <extension point="org.datanucleus.cache_level1">
	    <cache name="MyCache" class-name="mydomain.MyLevel1Cache"/>
    </extension>
</plugin>]]></source>
                <p>
                    Note that you also require a MANIFEST.MF file as per the
                    <a href="index.html">PluginPoints Guide</a>.
                </p>
            </subsection>

            <subsection name="Plugin Usage">
                <p>
                    The only thing remaining is to use your L1 Cache plugin. To do this you specify the 
                    persistence property <i>datanucleus.cache.level1.type</i> as <b>MyCache</b> 
                    (the "name" in <i>plugin.xml</i>).
                </p>
            </subsection>
        </section>
    </body>
</document>